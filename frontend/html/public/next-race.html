<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Next Race</title>
  <link rel="stylesheet" >
</head>
<body>


  <div>
    <h1>Next Race</h1>
    <div>
      <div id="currentDrivers"> </div>
      <div>Session Name: <div id="name">..</div></div>
      <div>Car: <div id="car">..</div></div>
      <div>Status: <div id="status">..</div></div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script type="module">
    const socket = io();

    const name = document.getElementById("name");
    const date = document.getElementById("date");
    const track = document.getElementById("track");
    const status = document.getElementById("status");
    const currentDrivers = document.getElementById("currentDrivers");


  function updateNextRace(state) {
    if(state === undefined){
        return;
    }
    // console.log(state)
    if(state.upComingRaces[0].sessionName === null){
      return;
    }
    if (state.upComingRaces) {
      currentDrivers.innerHTML = state.upComingRaces[0].drivers
      .map(driver => `<div>${driver.name} (Car ${driver.car})</div>`)
    }
  }

    // If connected, update data
    socket.on("connect", () => {
      socket.emit("state:get");
    });

    // Take data and call function to update ui
    socket.on("state:update", (state) => {
      console.log(state)
      updateNextRace(state);
    });





  </script>
</body>
</html>
