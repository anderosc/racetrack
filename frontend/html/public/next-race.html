<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Next Race</title>
  <link rel="stylesheet" >
</head>
<body>


  <div>
    <h1>Next Race</h1>
    <div>
      <div id="nextSession"></div>
      <div id="nextDrivers"> </div>

      <div id="err" style="display: none;">No upcoming races!</div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script type="module">
    const socket = io();

    const name = document.getElementById("name");
    const date = document.getElementById("date");
    const track = document.getElementById("track");
    const err = document.getElementById("err");
    const nextDrivers = document.getElementById("nextDrivers");
    const nextSession = document.getElementById("nextSession")


  function updateNextRace(state) {
    if(state === undefined){
        return;
    }
    // console.log(state)
    if(!state?.upComingRaces || state.upComingRaces.length === 0){
      err.style.display = "block"
      nextSession.innerHTML = "";
      nextDrivers.innerHTML = "";
      return;
    }
    const race = state.upComingRaces[0];
    if (!race?.sessionName) {
      err.style.display = "block";
      return;
    }

    err.style.display = "none";
    nextSession.innerHTML = "Next Session: " + race.sessionName;
    nextDrivers.innerHTML = race.drivers
    .map(driver => `<div>${driver.name} (Car ${driver.carNumber})</div>`)
    .join("");
  }

    // If connected, update data
    socket.on("connect", () => {
      socket.emit("state:get");
    });

    // Take data and call function to update ui
    socket.on("state:update", (state) => {
      console.log(state)
      updateNextRace(state);
    });





  </script>
</body>
</html>
