<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="/main.css">
        <title>RaceTrack</title>
    </head>
    <body>
        <div class="container left">
            <div class="button"><a href="../front-desk"><p>Front Desk</p></div></a>
            <div class="button"><a href="../race-control"><p>Race Control</p></div></a>
            <div class="button"><a href="../lap-line-tracker"><p>Lap-line Tracker</p></div></a>
            <div class="button"><a href="../leader-board"><p>Leader Board</p></div></a>
            <div class="button"><a href="../next-race"><p>Next Race</p></div></a>
            <div class="button"><a href="../race-countdown"><p>Race Countdown</p></div></a>
            <div class="button"><a href="../race-flags"><p>Race Flag</p></div></a>
        </div>
        <div class="container right">
            <div class="loginbox">
                <label for="token"><p>Enter Authorization Token</p></label>
                <input type="password" placeholder="Enter Authorization Token" id="token">
                <button id="login" class="loginbtn" type="submit"><p>Authorize</p></button>
                <div class="loginerror"><p>Authorization Failed, try again</p></div>
            </div>
        </div>
    </body>
</html>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();

    /*if() {
        document.getElementsByClassName("loginbox")[0].remove();
    }*/

    const button = document.getElementById("login");
    button.addEventListener("click", login);

    function login() {
        const input = document.getElementById("token");
        if (input.value) {
            socket.emit('login', { persona: 'Receptionist', token: input.value });
        }
    };

    socket.on('login', (msg) => {
        const input = document.getElementById("token");
        const persona = msg.persona;
        const status = msg.status;
        if(persona == "Receptionist") {
            if(status) {
                if(msg.cookie != true) {
                    document.cookie = "receptionist_token=" +  input.value + "; path=/";
                }
                document.getElementsByClassName("loginbox")[0].remove();
            }else {
                document.getElementsByClassName("loginerror")[0].style.display = 'inline-block';
                input.value = "";
            }
        }
    });

</script>